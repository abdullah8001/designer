<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>AI Particle Matrix | Abdullah Shish</title>

<style>
body {
  margin: 0;
  background: black;
  overflow: hidden;
  font-family: "Segoe UI", sans-serif;
  color: cyan;
}
#ui {
  position: fixed;
  top: 20px;
  left: 20px;
  background: rgba(0,0,0,0.7);
  padding: 14px;
  border-radius: 14px;
  border: 1px solid cyan;
  box-shadow: 0 0 15px cyan;
  z-index: 10;
  max-width: 280px;
}
#video {
  position: fixed;
  bottom: 20px;
  right: 20px;
  width: 170px;
  border-radius: 12px;
  border: 2px solid cyan;
  transform: scaleX(-1);
}
.hint {
  font-size: 12px;
  opacity: 0.8;
}
#status {
  color: yellow;
  font-weight: bold;
  margin-bottom: 6px;
}
</style>
</head>

<body>

<div id="ui">
  <h3>üåÄ AI Particle Matrix</h3>
  <div id="status">Loading AI...</div>
  <div class="hint">
    ‚òùÔ∏è1 Finger ‚Üí Flower<br>
    ‚úåÔ∏è3 Fingers ‚Üí DNA<br>
    ‚úã5 Fingers ‚Üí Sphere<br>
    ‚ù§Ô∏è4 Fingers ‚Üí Heart<br>
    üëç Thumb Up ‚Üí Robot<br>
    üëå OK ‚Üí Vortex<br>
    üòä Smile ‚Üí Bigger Particles<br>
    üòâ Blink ‚Üí Random Color
  </div>
</div>

<video id="video" autoplay playsinline></video>

<script src="https://cdn.jsdelivr.net/npm/three@0.150.0/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.150.0/examples/js/loaders/GLTFLoader.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/face_mesh.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>

<script>
let scene, camera, renderer, particles, model;
const COUNT = 12000;
let target = new Float32Array(COUNT * 3);
let active = "";
let lastBlink = 0;

/* ---------------- INIT THREE ---------------- */
scene = new THREE.Scene();

camera = new THREE.PerspectiveCamera(75, innerWidth/innerHeight, 0.1, 1000);
camera.position.z = 65;

renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
renderer.setSize(innerWidth, innerHeight);
document.body.appendChild(renderer.domElement);

/* ---------------- PARTICLES ---------------- */
const geo = new THREE.BufferGeometry();
const pos = new Float32Array(COUNT * 3);
for (let i = 0; i < pos.length; i++) pos[i] = (Math.random()-0.5)*80;
geo.setAttribute("position", new THREE.BufferAttribute(pos,3));

const mat = new THREE.PointsMaterial({
  size: 0.15,
  color: 0x00ffff,
  transparent: true,
  blending: THREE.AdditiveBlending,
  depthWrite: false
});

particles = new THREE.Points(geo, mat);
scene.add(particles);

/* ---------------- ROBOT ---------------- */
new THREE.GLTFLoader().load(
  "https://threejs.org/examples/models/gltf/RobotExpressive/RobotExpressive.glb",
  gltf => {
    model = gltf.scene;
    model.scale.set(5,5,5);
    model.position.y = -15;
    model.visible = false;
    scene.add(model);
  }
);

/* ---------------- SHAPES ---------------- */
function shape(type){
  if(active === type) return;
  active = type;
  document.getElementById("status").innerText = "Mode: " + type.toUpperCase();

  if(type === "robot"){
    particles.visible = false;
    if(model) model.visible = true;
    return;
  } else {
    particles.visible = true;
    if(model) model.visible = false;
  }

  for(let i=0;i<COUNT;i++){
    const i3 = i*3;
    const r = i/COUNT;
    let x,y,z;

    if(type==="flower"){
      const t = r*Math.PI*20;
      const rad = 20*Math.cos(1.2*t);
      x = rad*Math.cos(t);
      y = rad*Math.sin(t);
      z = (Math.random()-0.5)*2;
    }
    else if(type==="dna"){
      const t = r*Math.PI*30;
      const s = i%2?1:-1;
      x = 10*Math.cos(t)*s;
      y = r*100-50;
      z = 10*Math.sin(t)*s;
    }
    else if(type==="heart"){
      const t = r*Math.PI*2;
      x = 16*Math.pow(Math.sin(t),3);
      y = 13*Math.cos(t)-5*Math.cos(2*t)-2*Math.cos(3*t)-Math.cos(4*t);
      z = (Math.random()-0.5)*5;
    }
    else if(type==="vortex"){
      const a = Math.random()*Math.PI*2;
      const rad = 5+Math.random()*25;
      x = rad*Math.cos(a);
      y = rad*Math.sin(a);
      z = (Math.random()-0.5)*10;
    }
    else {
      const phi = Math.acos(-1+2*r);
      const theta = Math.sqrt(COUNT*Math.PI)*phi;
      x = 35*Math.cos(theta)*Math.sin(phi);
      y = 35*Math.sin(theta)*Math.sin(phi);
      z = 35*Math.cos(phi);
    }

    target[i3]=x; target[i3+1]=y; target[i3+2]=z;
  }
}

shape("sphere");

/* ---------------- MEDIAPIPE ---------------- */
const video = document.getElementById("video");

navigator.mediaDevices.getUserMedia({video:true})
.then(stream => video.srcObject = stream)
.catch(()=>alert("Camera allow karna padega bro üò≠"));

const hands = new Hands({
  locateFile: f => `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${f}`
});
hands.setOptions({
  maxNumHands:1,
  minDetectionConfidence:0.7,
  minTrackingConfidence:0.7
});

hands.onResults(res=>{
  if(!res.multiHandLandmarks) return;
  const lm = res.multiHandLandmarks[0];

  let fingers = 0;
  if(lm[8].y < lm[6].y) fingers++;
  if(lm[12].y < lm[10].y) fingers++;
  if(lm[16].y < lm[14].y) fingers++;
  if(lm[20].y < lm[18].y) fingers++;
  if(lm[4].y < lm[3].y) fingers++;

  const ok = Math.hypot(lm[4].x-lm[8].x,lm[4].y-lm[8].y)<0.05;

  if(ok) shape("vortex");
  else if(fingers===1) shape("flower");
  else if(fingers===3) shape("dna");
  else if(fingers===4) shape("heart");
  else if(fingers===5) shape("sphere");
  else if(lm[4].y < lm[3].y && fingers===1) shape("robot");

  particles.position.x = (lm[0].x-0.5)*-20;
  particles.position.y = (lm[0].y-0.5)*-20;
});

const face = new FaceMesh({
  locateFile:f=>`https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/${f}`
});
face.setOptions({
  maxNumFaces:1,
  refineLandmarks:true,
  minDetectionConfidence:0.7,
  minTrackingConfidence:0.7
});

face.onResults(res=>{
  if(!res.multiFaceLandmarks) return;
  const lm = res.multiFaceLandmarks[0];

  const mouth = Math.hypot(lm[61].x-lm[291].x,lm[61].y-lm[291].y);
  mat.size = mouth>0.15 ? 0.35 : 0.15;

  const eye = Math.hypot(lm[159].y-lm[145].y);
  if(eye<0.015 && Date.now()-lastBlink>500){
    mat.color.setHex(Math.random()*0xffffff);
    lastBlink = Date.now();
  }
});

const cam = new Camera(video,{
  onFrame:async()=>{
    await hands.send({image:video});
    await face.send({image:video});
  },
  width:640,height:480
});
cam.start();
document.getElementById("status").innerText="AI Live üü¢";

/* ---------------- ANIMATE ---------------- */
function animate(){
  requestAnimationFrame(animate);
  const p = particles.geometry.attributes.position.array;
  for(let i=0;i<p.length;i++){
    p[i] += (target[i]-p[i])*0.08;
  }
  particles.geometry.attributes.position.needsUpdate=true;
  particles.rotation.y+=0.002;
  if(model && model.visible) model.rotation.y+=0.01;
  renderer.render(scene,camera);
}
animate();

addEventListener("resize",()=>{
  camera.aspect=innerWidth/innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(innerWidth,innerHeight);
});
</script>

</body>
</html>
